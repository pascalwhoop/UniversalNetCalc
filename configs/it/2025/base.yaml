meta:
  country: "it"
  year: 2025
  currency: "EUR"
  version: "2.0.0"
  sources:
    - url: "https://www.agenziaentrate.gov.it/portale/web/english/personal-income-tax-rates-and-calculation"
      description: "Official Italian Tax Authority (Agenzia Entrate) - IRPEF rates for 2025"
      retrieved_at: "2026-01-22"
    - url: "https://www.pagheon-line.com/infoter/help/Pa/DOC-IRPEF-ADDIZIONALI.html"
      description: "Regional and municipal surch arges (addizionale regionale and comunale) by region for 2025"
      retrieved_at: "2026-01-22"
    - url: "https://taxsummaries.pwc.com/italy/individual/taxes-on-personal-income"
      description: "PwC Tax Summaries - Italy individual taxes 2025"
      retrieved_at: "2026-01-22"
  updated_at: "2026-01-22"

notices:
  - id: "salary_input"
    title: "Annual Gross Salary"
    body: "Enter your total annual gross salary before any deductions. This should be your employment income before taxes and social security contributions."
    severity: "info"
  - id: "regional_tax"
    title: "Regional Tax Varies by Location"
    body: "Regional tax (addizionale regionale) rates are set by each region and range from 1.23% to 3.33%. Select your region of residence to apply the correct rate."
    severity: "info"
  - id: "employment_credit"
    title: "Employment Tax Credit Applied"
    body: "Your IRPEF is reduced by the employment tax credit (detrazione lavoro dipendente). This creates a 'no-tax area' for incomes up to €8,500 and reduces the effective tax rate for low to middle incomes."
    severity: "info"
  - id: "inps_cut"
    title: "Social Security Relief for 2025"
    body: "For 2025, the government provides a 7 percentage point cut in INPS contributions for incomes up to €25,000, and 6 percentage points for €25,001-€35,000."
    severity: "info"

inputs:
  gross_annual:
    type: number
    required: true
    min: 0
    label: "Annual Gross Salary"
    description: "Your total yearly salary before any deductions"

  region_level_1:
    type: enum
    required: true
    default: "lazio"
    label: "Region of Residence"
    description: "Select your Italian region (determines regional tax rate)"
    options:
      abruzzo:
        label: "Abruzzo"
        description: "Progressive regional tax: 1.67% to 3.33%"
      basilicata:
        label: "Basilicata"
        description: "Regional tax: 1.23%"
      calabria:
        label: "Calabria"
        description: "Regional tax: 2.03%"
      campania:
        label: "Campania"
        description: "Regional tax: 2.33%"
      emilia_romagna:
        label: "Emilia-Romagna"
        description: "Progressive regional tax: 1.33% to 3.33%"
      friuli_venezia_giulia:
        label: "Friuli-Venezia Giulia"
        description: "Regional tax: 1.23%"
      lazio:
        label: "Lazio (Rome)"
        description: "Progressive regional tax: 1.73% to 3.33%"
      liguria:
        label: "Liguria"
        description: "Progressive regional tax: 1.23% to 2.33%"
      lombardia:
        label: "Lombardia (Milan)"
        description: "Progressive regional tax: 1.23% to 3.33%"
      marche:
        label: "Marche"
        description: "Regional tax: 1.73%"
      molise:
        label: "Molise"
        description: "Progressive regional tax: 1.73% to 3.33%"
      piemonte:
        label: "Piemonte (Turin)"
        description: "Progressive regional tax: 1.62% to 3.33%"
      puglia:
        label: "Puglia"
        description: "Progressive regional tax: 1.23% to 3.33%"
      sardegna:
        label: "Sardegna"
        description: "Regional tax: 1.23%"
      sicilia:
        label: "Sicilia"
        description: "Progressive regional tax: 1.23% to 2.33%"
      toscana:
        label: "Toscana (Florence)"
        description: "Progressive regional tax: 1.42% to 3.33%"
      trentino_alto_adige_bolzano:
        label: "Trentino-Alto Adige (Bolzano)"
        description: "Progressive regional tax: 1.23% to 1.73%"
      trentino_alto_adige_trento:
        label: "Trentino-Alto Adige (Trento)"
        description: "Regional tax: 1.23%"
      umbria:
        label: "Umbria"
        description: "Progressive regional tax: 1.73% to 3.33%"
      valle_d_aosta:
        label: "Valle d'Aosta"
        description: "Regional tax: 1.23%"
      veneto:
        label: "Veneto (Venice)"
        description: "Progressive regional tax: 1.23% to 2.33%"

parameters:
  # IRPEF (National Income Tax) brackets for 2025
  irpef_brackets:
    - { threshold: 0, rate: 0.23 }
    - { threshold: 28000, rate: 0.35 }
    - { threshold: 50000, rate: 0.43 }

  # Employment Tax Credit (Detrazione lavoro dipendente) thresholds
  # This creates the "no-tax area" (area di non tassazione) of €8,500
  employment_credit_max: 1955          # Maximum credit (creates no-tax area at €8,500)
  employment_credit_tier2_base: 1910   # Base for income €15,001-€28,000
  employment_credit_tier2_additional: 1190  # Additional amount that phases out
  employment_credit_tier1_threshold: 15000
  employment_credit_tier2_threshold: 28000
  employment_credit_tier3_threshold: 50000

  # Additional €65 for incomes €25,000-€35,000
  employment_credit_bonus: 65
  employment_credit_bonus_min: 25000
  employment_credit_bonus_max: 35000

  # INPS (Social Security) - Employee contribution
  # Standard rate is 9.19%, but reduced to ~7% for incomes up to €25,000 (cuneo fiscale)
  # Using 9.19% as standard rate; low-income cuts modeled separately
  inps_employee_rate: 0.0919

  # INPS contribution cut for low incomes (cuneo fiscale 2025)
  # 7 percentage points cut for income up to €25,000
  # 6 percentage points cut for income €25,001-€35,000
  inps_cut_threshold_1: 25000
  inps_cut_threshold_2: 35000
  inps_cut_rate_1: 0.07   # Cut for incomes up to €25,000
  inps_cut_rate_2: 0.06   # Cut for incomes €25,001-€35,000

  # Regional tax rates by region
  regional_tax_rates:
    # Flat rate regions
    basilicata: 0.0123
    calabria: 0.0203
    campania: 0.0233
    friuli_venezia_giulia: 0.0123
    marche: 0.0173
    sardegna: 0.0123
    trentino_alto_adige_trento: 0.0123
    valle_d_aosta: 0.0123

    # Progressive regions - using weighted average for simplicity
    # (In a full implementation, these would be bracket-based)
    abruzzo: 0.0227  # Average of progressive brackets
    emilia_romagna: 0.0233  # Average
    lazio: 0.0253  # Average
    liguria: 0.0178  # Average
    lombardia: 0.0228  # Average
    molise: 0.0266  # Average
    piemonte: 0.0248  # Average
    puglia: 0.0228  # Average
    sicilia: 0.0178  # Average
    toscana: 0.0238  # Average
    trentino_alto_adige_bolzano: 0.0148  # Average
    umbria: 0.0269  # Average
    veneto: 0.0178  # Average

  # Municipal tax - average rate (varies by municipality from 0% to 0.9%)
  # Most major cities charge 0.8% for incomes above a threshold
  municipal_tax_rate: 0.008

calculations:
  # Taxable income (for standard case, same as gross annual)
  - id: taxable_income
    type: identity
    value: "@gross_annual"

  # Gross National Income Tax (IRPEF) before credits
  - id: irpef_gross
    type: bracket_tax
    base: "$taxable_income"
    brackets: "$irpef_brackets"

  # Employment Tax Credit (Detrazione lavoro dipendente)
  # This creates the "no-tax area" and reduces effective tax burden
  # Formula varies by income band:
  # - Up to €15,000: €1,955
  # - €15,001-€28,000: €1,910 + €1,190 × [(€28,000 - income) / €13,000]
  # - €28,001-€50,000: €1,910 × [(€50,000 - income) / €22,000]
  # - Over €50,000: €0
  - id: employment_credit_base
    type: conditional
    condition:
      type: lte
      left: "@gross_annual"
      right: "$employment_credit_tier1_threshold"
    then: "$employment_credit_max"
    else:
      type: conditional
      condition:
        type: lte
        left: "@gross_annual"
        right: "$employment_credit_tier2_threshold"
      then:
        type: sum
        values:
          - "$employment_credit_tier2_base"
          - type: mul
            values:
              - "$employment_credit_tier2_additional"
              - type: div
                values:
                  - type: sub
                    values:
                      - "$employment_credit_tier2_threshold"
                      - "@gross_annual"
                  - 13000
      else:
        type: conditional
        condition:
          type: lte
          left: "@gross_annual"
          right: "$employment_credit_tier3_threshold"
        then:
          type: mul
          values:
            - "$employment_credit_tier2_base"
            - type: div
              values:
                - type: sub
                  values:
                    - "$employment_credit_tier3_threshold"
                    - "@gross_annual"
                - 22000
        else: 0

  # Additional €65 for incomes €25,000-€35,000
  - id: employment_credit_bonus_amount
    type: conditional
    condition:
      type: gte
      left: "@gross_annual"
      right: "$employment_credit_bonus_min"
    then:
      type: conditional
      condition:
        type: lte
        left: "@gross_annual"
        right: "$employment_credit_bonus_max"
      then: "$employment_credit_bonus"
      else: 0
    else: 0

  # Total employment tax credit
  - id: employment_credit
    type: sum
    values:
      - "$employment_credit_base"
      - "$employment_credit_bonus_amount"

  # Net IRPEF after employment credit (cannot go below 0)
  - id: irpef
    type: max
    values:
      - 0
      - type: sub
        values:
          - "$irpef_gross"
          - "$employment_credit"
    category: income_tax
    label: "IRPEF (National Income Tax)"

  # Employment credit display (as negative value for breakdown)
  # Shows the amount saved due to the credit
  - id: employment_credit_display
    type: credit
    amount: "$employment_credit"
    refundable: false
    category: credit
    label: "Employment Tax Credit (Detrazione)"
    description: "Reduces IRPEF based on income level"

  # Regional tax rate based on region selection
  - id: regional_tax_rate
    type: switch
    on: "@region_level_1"
    cases:
      basilicata: 0.0123
      calabria: 0.0203
      campania: 0.0233
      friuli_venezia_giulia: 0.0123
      marche: 0.0173
      sardegna: 0.0123
      trentino_alto_adige_trento: 0.0123
      valle_d_aosta: 0.0123
      abruzzo: 0.0227
      emilia_romagna: 0.0233
      lazio: 0.0253
      liguria: 0.0178
      lombardia: 0.0228
      molise: 0.0266
      piemonte: 0.0248
      puglia: 0.0228
      sicilia: 0.0178
      toscana: 0.0238
      trentino_alto_adige_bolzano: 0.0148
      umbria: 0.0269
      veneto: 0.0178
    default: 0.0173

  # Regional Income Tax (Addizionale Regionale)
  - id: regional_tax
    type: percent_of
    base: "$taxable_income"
    rate: "$regional_tax_rate"
    category: income_tax
    label: "Regional Tax (Addizionale Regionale)"

  # Municipal Income Tax (Addizionale Comunale)
  # Using average rate of 0.8% (actual rates vary by municipality)
  - id: municipal_tax
    type: percent_of
    base: "$taxable_income"
    rate: "$municipal_tax_rate"
    category: income_tax
    label: "Municipal Tax (Addizionale Comunale, ~0.8% avg)"

  # Total Income Tax
  - id: total_income_tax
    type: sum
    values:
      - "$irpef"
      - "$regional_tax"
      - "$municipal_tax"

  # INPS contribution cut rate based on income (cuneo fiscale)
  # 7 percentage points cut for income up to €25,000
  # 6 percentage points cut for income €25,001-€35,000
  # No cut above €35,000
  - id: inps_cut_rate
    type: conditional
    condition:
      type: lte
      left: "@gross_annual"
      right: "$inps_cut_threshold_1"
    then: "$inps_cut_rate_1"
    else:
      type: conditional
      condition:
        type: lte
        left: "@gross_annual"
        right: "$inps_cut_threshold_2"
      then: "$inps_cut_rate_2"
      else: 0

  # Effective INPS rate after cut
  - id: inps_effective_rate
    type: sub
    values:
      - "$inps_employee_rate"
      - "$inps_cut_rate"

  # Social Security Contributions (INPS) - Employee portion
  - id: inps_employee
    type: percent_of
    base: "@gross_annual"
    rate: "$inps_effective_rate"
    category: contribution
    label: "Social Security (INPS - Employee)"

  # Total Deductions
  - id: total_deductions
    type: sum
    values:
      - "$total_income_tax"
      - "$inps_employee"

  # Net Annual Salary
  - id: net_annual
    type: sub
    values:
      - "@gross_annual"
      - "$total_deductions"

outputs:
  gross: "@gross_annual"
  net: "$net_annual"
  effective_rate:
    type: div
    values:
      - "$total_deductions"
      - "@gross_annual"
  breakdown:
    taxes:
      - "$irpef"
      - "$regional_tax"
      - "$municipal_tax"
    contributions:
      - "$inps_employee"
    credits:
      - "$employment_credit_display"
