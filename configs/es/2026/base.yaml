meta:
  country: "es"
  year: 2026
  currency: "EUR"
  version: "1.0.0"
  sources:
    - url: "https://sede.agenciatributaria.gob.es/Sede/en_gb/"
      description: "Spanish Tax Agency (Agencia Tributaria) - Official 2026 IRPF rates"
      retrieved_at: "2026-02-22"
    - url: "https://www.seg-social.es"
      description: "Spanish Social Security - Contribution rates and bases 2026"
      retrieved_at: "2026-02-22"
    - url: "https://afinom.es/bases-y-tipos-de-cotizacion-2026/"
      description: "Bases y tipos de cotización 2026 - detailed breakdown of SS rates"
      retrieved_at: "2026-02-22"
    - url: "https://payfit.com/es/contenido-practico/base-cotizacion-maxima/"
      description: "Base de cotización máxima 2026 - PayFit"
      retrieved_at: "2026-02-22"
  updated_at: "2026-02-22"
  notes: |
    This configuration covers the standard Spanish income tax system (IRPF) for 2026,
    focusing on national (state) tax rates. Regional variations apply but are not
    included in this base configuration.

    Key characteristics:
    - Progressive national income tax with 6 brackets (19% to 47%) — unchanged from 2025
    - Personal allowance of €5,550 (applied as tax credit) — unchanged from 2025
    - Social Security employee contribution: 6.50% up to maximum base (€61,214.40/year)
      - Contingencias comunes: 4.70%
      - Desempleo: 1.55%
      - Formación profesional: 0.10%
      - MEI (Mecanismo de Equidad Intergeneracional): 0.15% (increased from 0.13% in 2025)
    - SS max base increased to €5,101.20/month (€61,214.40/year), up from €58,914 in 2025
    - Solidarity contribution (cotización adicional de solidaridad) now uses progressive bracket
      rates for employee portion: 0.19% / 0.21% / 0.24%
    - Regional autonomous community taxes add approximately 5-10% additional tax

    Important notes:
    - This configuration uses NATIONAL (state) tax rates only
    - Regional rates vary by autonomous community (Madrid ~45% total, Catalonia ~50% total)
    - Tax residents are taxed on worldwide income
    - This is for employees (not self-employed/autónomos)
    - Source: Real Decreto-ley 3/2026 fija base máxima en €5,101.20/mes

notices:
  - id: "national_rates_only"
    title: "National Tax Rates Only"
    body: |
      This calculator uses only the national (state) tax rates. Spain's autonomous
      communities add their own regional income tax, typically 5-10% additional.
      Total effective rates range from ~45% (Madrid) to ~50% (Catalonia) for high earners.
    severity: "warning"

  - id: "social_security_max_base"
    title: "Social Security Maximum Base"
    body: |
      Social Security contributions are capped at €61,214.40 annually (€5,101.20/month) for 2026.
      Income above this threshold is subject to a solidarity contribution at progressive rates
      (0.19%, 0.21%, or 0.24% employee portion depending on the bracket).
    severity: "info"

  - id: "personal_allowance"
    title: "Personal Allowance (Mínimo Personal)"
    body: |
      The personal allowance of €5,550 is applied as a tax credit (not a deduction from income).
      The credit reduces your final tax liability by the tax that would be paid on €5,550.
    severity: "info"

  - id: "beckham_law_available"
    title: "Beckham Law Option Available"
    body: |
      If you're relocating to Spain for work and meet eligibility requirements, you may
      qualify for the Beckham Law (24% flat tax rate). See the "beckham-law" variant.
      You must apply within 6 months of starting work in Spain.
    severity: "info"

inputs:
  gross_annual:
    type: number
    required: true
    min: 0
    label: "Annual Gross Salary"
    description: "Your total yearly salary before any deductions"

  filing_status:
    type: enum
    required: true
    default: "single"
    label: "Filing Status"
    options:
      single:
        label: "Single"
        description: "Individual tax filing (standard in Spain)"
      joint:
        label: "Joint Filing"
        description: "Married filing jointly (rare in Spain, usually less favorable)"

parameters:
  # National (State) IRPF tax brackets 2026
  # These are the state portion only; regions add their own
  # Unchanged from 2025
  national_tax_brackets:
    - threshold: 0
      rate: 0.19
    - threshold: 12450
      rate: 0.24
    - threshold: 20200
      rate: 0.30
    - threshold: 35200
      rate: 0.37
    - threshold: 60000
      rate: 0.45
    - threshold: 300000
      rate: 0.47

  # Personal allowance (Mínimo Personal) 2026 — unchanged from 2025
  personal_allowance: 5550

  # Social Security contribution rates 2026
  # Total employee rate: 4.70% (comunes) + 1.55% (desempleo) + 0.10% (FP) + 0.15% (MEI) = 6.50%
  social_security_employee_rate: 0.0650
  # Max base: €5,101.20/month × 12 = €61,214.40/year
  social_security_max_base: 61214.40

  # Solidarity contribution 2026 (progressive bracket for employee portion)
  # Monthly thresholds converted to annual: 5,611.32 × 12 = 67,335.84; 7,651.80 × 12 = 91,821.60
  solidarity_brackets:
    - threshold: 0
      rate: 0.0019
    - threshold: 6121.44
      rate: 0.0021
    - threshold: 30607.20
      rate: 0.0024

calculations:
  # Taxable income (for standard case, same as gross)
  - id: taxable_income
    type: identity
    value: "@gross_annual"

  # National income tax (state portion only)
  - id: national_income_tax
    type: bracket_tax
    base: "$taxable_income"
    brackets: "$national_tax_brackets"
    category: income_tax
    label: "National Income Tax (IRPF - State)"
    description: "Progressive national income tax at state level"

  # Personal allowance tax credit
  # Calculate the tax that would be paid on the personal allowance amount
  - id: personal_allowance_tax_credit_amount
    type: bracket_tax
    base: "$personal_allowance"
    brackets: "$national_tax_brackets"

  - id: personal_allowance_credit
    type: credit
    amount: "$personal_allowance_tax_credit_amount"
    refundable: false
    category: credit
    label: "Personal Allowance Credit"
    description: "Tax credit based on personal allowance (Mínimo Personal) of €5,550"

  # Social Security contributions
  # Employee pays 6.50% up to maximum base
  - id: social_security_base
    type: min
    values:
      - "@gross_annual"
      - "$social_security_max_base"

  - id: social_security_contribution
    type: mul
    values:
      - "$social_security_base"
      - "$social_security_employee_rate"
    category: contribution
    label: "Social Security Contribution"
    description: "Employee Social Security contribution (6.50% up to €61,214.40)"

  # Solidarity contribution (for income above max SS base)
  # Progressive bracket rates: 0.19%, 0.21%, 0.24% (employee portion)
  - id: income_above_ss_max
    type: max
    values:
      - 0
      - type: sub
        values:
          - "@gross_annual"
          - "$social_security_max_base"

  - id: solidarity_contribution
    type: bracket_tax
    base: "$income_above_ss_max"
    brackets: "$solidarity_brackets"
    category: contribution
    label: "Solidarity Contribution"
    description: "Progressive solidarity contribution on income above Social Security max base"

  # Total tax before credits
  - id: total_tax_before_credits
    type: sum
    values:
      - "$national_income_tax"

  # Tax after credits (cannot be negative)
  - id: tax_after_credits
    type: max
    values:
      - 0
      - type: sub
        values:
          - "$total_tax_before_credits"
          - "$personal_allowance_tax_credit_amount"

  # Total deductions (tax + social security + solidarity)
  - id: total_deductions
    type: sum
    values:
      - "$tax_after_credits"
      - "$social_security_contribution"
      - "$solidarity_contribution"

  # Net annual income
  - id: net_annual
    type: sub
    values:
      - "@gross_annual"
      - "$total_deductions"

outputs:
  gross: "@gross_annual"
  net: "$net_annual"
  effective_rate:
    type: div
    values:
      - type: sub
        values:
          - "@gross_annual"
          - "$net_annual"
      - "@gross_annual"
  breakdown:
    taxes:
      - "$national_income_tax"
      - "$social_security_contribution"
      - "$solidarity_contribution"
    credits:
      - "$personal_allowance_credit"
