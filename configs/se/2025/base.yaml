meta:
  country: "se"
  year: 2025
  currency: "SEK"
  version: "1.0.0"
  sources:
    - url: "https://www.skatteverket.se/privat/skatter/arbeteochinkomst.4.15532c7b1442f256bae11b60.html"
      description: "Swedish Tax Agency - Income Tax"
      retrieved_at: "2026-01-23"
    - url: "https://www.scb.se/en/finding-statistics/statistics-by-subject-area/public-finances/local-government-finances/local-taxes/"
      description: "Statistics Sweden - Municipal Tax Rates 2025"
      retrieved_at: "2026-01-23"
    - url: "https://nordisketax.net/pages/en-GB/taxation/?country=sweden&topic=tax-rates"
      description: "Nordic Tax - Tax Rates Sweden 2025"
      retrieved_at: "2026-01-23"
    - url: "https://www.skatteverket.se/privat/skatter/arbeteochinkomst/skattereduktioner/jobbskatteavdrag.4.6fdde64a12cc4eee2308000107.html"
      description: "Swedish Tax Agency - Work Tax Credit (Jobbskatteavdrag)"
      retrieved_at: "2026-01-23"
  updated_at: "2026-01-23"
  notes: |
    This configuration covers the Swedish tax system for 2025 for individuals under 66 years old.

    Key features:
    - Dual income tax system: Municipal tax (varies by location) + State tax (20% above SEK 625,800)
    - Basic deduction (Grundavdrag): SEK 17,300 for under 66, SEK 107,400 for 66+
    - Work tax credit (Jobbskatteavdrag): Automatic credit based on income (up to ~SEK 47,300/year)
    - NO employee social contributions (employer pays all 31.42%)

    Municipal tax rates (2025):
    - Stockholm: 30.60% (lowest major city)
    - Gothenburg: 31.50%
    - Malmö: 31.20%
    - National average: 32.41%
    - Range: 28.98% (Österåker) to 35.30% (Degerfors)

    Key changes from 2024:
    - State tax threshold increased to SEK 625,800
    - Work tax credit phaseout for high earners was abolished
    - Maximum marginal rate reduced from 55% to 52%

notices:
  - id: "salary_input"
    title: "Annual Gross Salary"
    body: |
      Enter your total annual gross salary before any deductions. This should be your
      full employment income as stated in your contract.
    severity: "info"

  - id: "municipal_tax_variation"
    title: "Municipal Tax Rates Vary by Location"
    body: |
      Sweden has 290 municipalities with different tax rates. The combined municipal and
      regional tax rate ranges from 28.98% to 35.30%, with a national average of 32.41%.

      Select your municipality from the dropdown. If your municipality is not listed,
      choose the closest major city or use the national average.
    severity: "info"

  - id: "no_employee_contributions"
    title: "No Employee Social Contributions"
    body: |
      Unlike many other countries, Swedish employees pay ZERO social security contributions
      directly from their salary. All social security funding (31.42%) is paid by the employer
      as a separate cost. Your net salary calculation only includes income tax.
    severity: "info"

  - id: "expert_tax_available"
    title: "Expert Tax Regime Available"
    body: |
      Foreign specialists may qualify for the Expert Tax regime, which provides a 25%
      exemption on income for up to 5 years. Requirements:
      - Monthly salary of SEK 113,000+ OR specialized expertise
      - Not lived in Sweden during previous 5 years
      - Apply within 3 months of starting work

      Use the "Expert Tax" variant to calculate with this benefit.
    severity: "info"

  - id: "under_66_only"
    title: "Under 66 Years Old"
    body: |
      This configuration is for individuals under 66 years old in 2025. If you are 66 or
      over, different rules apply (higher basic deduction of SEK 107,400).
    severity: "warning"

inputs:
  gross_annual:
    type: number
    required: true
    min: 0
    label: "Annual Gross Salary"
    description: "Your total yearly salary before any deductions"

  municipality:
    type: enum
    required: true
    default: "stockholm"
    label: "Municipality"
    description: "Your municipality/city in Sweden (affects municipal tax rate)"
    options:
      stockholm:
        label: "Stockholm"
        description: "30.60% municipal tax (lowest major city)"
      gothenburg:
        label: "Gothenburg (Göteborg)"
        description: "31.50% municipal tax"
      malmo:
        label: "Malmö"
        description: "31.20% municipal tax"
      uppsala:
        label: "Uppsala"
        description: "32.61% municipal tax"
      vasteras:
        label: "Västerås"
        description: "32.82% municipal tax"
      orebro:
        label: "Örebro"
        description: "33.49% municipal tax"
      linkoping:
        label: "Linköping"
        description: "33.27% municipal tax"
      helsingborg:
        label: "Helsingborg"
        description: "31.85% municipal tax"
      national_avg:
        label: "National Average"
        description: "32.41% municipal tax (use if your city not listed)"

parameters:
  # Municipal tax rates by city (combined municipal + regional tax)
  municipal_tax_rates:
    stockholm: 0.3060
    gothenburg: 0.3150
    malmo: 0.3120
    uppsala: 0.3261
    vasteras: 0.3282
    orebro: 0.3349
    linkoping: 0.3327
    helsingborg: 0.3185
    national_avg: 0.3241

  # State income tax
  state_tax_rate: 0.20
  state_tax_threshold: 625800

  # Basic deduction (Grundavdrag)
  basic_deduction_under_66: 17300
  basic_deduction_over_66: 107400  # For future use

  # Work tax credit (Jobbskatteavdrag) - 2025 parameters
  # The formula is complex and income-dependent
  # Maximum: SEK 3,941/month = ~SEK 47,300/year
  work_credit_max_annual: 47300

  # Work credit calculation parameters (simplified model)
  # The actual Swedish formula is extremely complex with multiple thresholds
  # This is a simplified approximation that gets close to real values
  work_credit_phase1_rate: 0.0805  # Up to SEK 12,169
  work_credit_phase2_rate: 0.3003  # SEK 12,169 - 26,288
  work_credit_phase2_base: 980
  work_credit_phase2_start: 12169
  work_credit_phase3_rate: 0.0226  # SEK 26,288 - 43,071
  work_credit_phase3_base: 5220
  work_credit_phase3_start: 26288
  work_credit_phase4_rate: -0.0651 # SEK 43,071 - 129,078 (phaseout)
  work_credit_phase4_base: 5599
  work_credit_phase4_start: 43071
  work_credit_phase5_start: 129078

calculations:
  # Get municipal tax rate based on selected municipality
  - id: municipal_tax_rate
    type: switch
    on: "@municipality"
    cases:
      stockholm: 0.3060
      gothenburg: 0.3150
      malmo: 0.3120
      uppsala: 0.3261
      vasteras: 0.3282
      orebro: 0.3349
      linkoping: 0.3327
      helsingborg: 0.3185
      national_avg: 0.3241
    default: 0.3241
    description: "Municipal and regional tax rate for selected municipality"

  # Basic deduction (Grundavdrag) - age dependent
  # For this config, using under 66 value only
  - id: basic_deduction
    type: identity
    value: "$basic_deduction_under_66"
    category: deduction
    label: "Basic Deduction"
    description: "Grundavdrag - tax-free allowance for under 66"

  # Taxable income after basic deduction
  - id: taxable_income
    type: max
    values:
      - 0
      - type: sub
        values:
          - "@gross_annual"
          - "$basic_deduction"

  # Municipal tax (on taxable income)
  - id: municipal_tax
    type: mul
    values:
      - "$taxable_income"
      - "$municipal_tax_rate"
    category: income_tax
    label: "Municipal Tax"
    description: "Combined municipal and regional tax (Kommunalskatt + Landstingsskatt)"

  # State tax (20% on income above threshold)
  - id: state_tax_base
    type: max
    values:
      - 0
      - type: sub
        values:
          - "$taxable_income"
          - "$state_tax_threshold"

  - id: state_tax
    type: mul
    values:
      - "$state_tax_base"
      - "$state_tax_rate"
    category: surtax
    label: "State Income Tax"
    description: "Statlig inkomstskatt - 20% on income above SEK 625,800"

  # Work tax credit (Jobbskatteavdrag)
  # Complex multi-phase calculation based on gross income
  # Phase 1: 0 - 12,169: 8.05% of income
  # Phase 2: 12,169 - 26,288: 980 + 30.03% of excess
  # Phase 3: 26,288 - 43,071: 5,220 + 2.26% of excess
  # Phase 4: 43,071 - 129,078: 5,599 - 6.51% of excess (phaseout)
  # Phase 5: 129,078+: 0

  - id: work_credit_raw
    type: conditional
    condition:
      type: lte
      left: "@gross_annual"
      right: "$work_credit_phase2_start"
    then:
      # Phase 1: 8.05% of income
      type: mul
      values:
        - "@gross_annual"
        - "$work_credit_phase1_rate"
    else:
      type: conditional
      condition:
        type: lte
        left: "@gross_annual"
        right: "$work_credit_phase3_start"
      then:
        # Phase 2: 980 + 30.03% of excess above 12,169
        type: sum
        values:
          - "$work_credit_phase2_base"
          - type: mul
            values:
              - type: sub
                values:
                  - "@gross_annual"
                  - "$work_credit_phase2_start"
              - "$work_credit_phase2_rate"
      else:
        type: conditional
        condition:
          type: lte
          left: "@gross_annual"
          right: "$work_credit_phase4_start"
        then:
          # Phase 3: 5,220 + 2.26% of excess above 26,288
          type: sum
          values:
            - "$work_credit_phase3_base"
            - type: mul
              values:
                - type: sub
                  values:
                    - "@gross_annual"
                    - "$work_credit_phase3_start"
                - "$work_credit_phase3_rate"
        else:
          type: conditional
          condition:
            type: lte
            left: "@gross_annual"
            right: "$work_credit_phase5_start"
          then:
            # Phase 4: 5,599 - 6.51% of excess above 43,071 (phaseout)
            type: sub
            values:
              - "$work_credit_phase4_base"
              - type: mul
                values:
                  - type: sub
                    values:
                      - "@gross_annual"
                      - "$work_credit_phase4_start"
                  - "$work_credit_phase4_rate"
          else:
            # Phase 5: No credit above 129,078
            0

  - id: work_tax_credit
    type: credit
    amount:
      type: max
      values:
        - 0
        - "$work_credit_raw"
    refundable: false
    category: credit
    label: "Work Tax Credit"
    description: "Jobbskatteavdrag - automatic tax credit for work income"

  # Total tax before credits
  - id: total_tax_before_credits
    type: sum
    values:
      - "$municipal_tax"
      - "$state_tax"

  # Total credits
  - id: total_credits
    type: max
    values:
      - 0
      - "$work_credit_raw"

  # Final tax (cannot be negative)
  - id: total_tax
    type: max
    values:
      - 0
      - type: sub
        values:
          - "$total_tax_before_credits"
          - "$total_credits"

  # Net annual income
  - id: net_annual
    type: sub
    values:
      - "@gross_annual"
      - "$total_tax"

outputs:
  gross: "@gross_annual"
  net: "$net_annual"
  effective_rate:
    type: div
    values:
      - type: sub
        values:
          - "@gross_annual"
          - "$net_annual"
      - "@gross_annual"
  breakdown:
    taxes:
      - "$municipal_tax"
      - "$state_tax"
    deductions:
      - "$basic_deduction"
    credits:
      - "$work_tax_credit"
